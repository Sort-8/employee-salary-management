<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.salary.dao.SalaryConfigDao">

    <select id="getAllSalaryConfig" resultType="com.salary.entity.SalaryConfig">
        select sc.config_id,sc.user_id,u.login_name,sc.base_salary,sc.`leave`,sc.late,sc.absence,sc.overtime,sc.create_time,sc.updater,sc.update_time,sc.remark
        from salary_config sc
        join user u on u.user_id=sc.user_id
        order by sc.create_time desc
    </select>

    <update id="updateSalaryConfig" parameterType="com.salary.entity.SalaryConfig">
        UPDATE salary_config
        <set>
            <if test="base_salary != null and base_salary != ''">base_salary = #{base_salary},</if>
            <if test="leave != null and leave != ''">`leave` = #{leave},</if>
            <if test="late != null and late != ''">late = #{late},</if>
            <if test="absence != null and late != ''">absence = #{absence},</if>
            <if test="overtime != null and late != ''">overtime = #{overtime},</if>
            <if test="remark != null and remark != ''">remark = #{remark},</if>
            <if test="updater != null and updater != ''">updater = #{updater},</if>
            update_time=NOW()
        </set>
        WHERE config_id=#{config_id}
    </update>

    <insert id="insertSalaryConfig" parameterType="com.salary.entity.SalaryConfig">
        insert into salary_config(
            <if test="user_id != null and user_id != ''">user_id,</if>
            <if test="base_salary != null and base_salary != ''">base_salary,</if>
            <if test="late != null and late != ''">late,</if>
            <if test="absence != null and absence != ''">absence,</if>
            <if test="overtime != null and overtime != ''">overtime,</if>
            <if test="remark != null and remark != ''">remark,</if>
            <if test="creater != null and creater != ''">creater,</if>
            create_time
        )values(
            <if test="user_id != null and user_id != ''">#{user_id},</if>
            <if test="base_salary != null and base_salary != ''">#{base_salary},</if>
            <if test="late != null and late != ''">#{late},</if>
            <if test="absence != null and absence != ''">#{absence},</if>
            <if test="overtime != null and overtime != ''">#{overtime},</if>
            <if test="remark != null and remark != ''">#{remark},</if>
            <if test="creater != null and creater != ''">#{creater},</if>
            NOW()
        )
    </insert>

    <select id="searchSalaryConfig" parameterType="java.util.HashMap" resultType="com.salary.entity.SalaryConfig">
        select sc.config_id,sc.user_id,u.login_name,sc.base_salary,sc.late,sc.absence,sc.overtime,sc.create_time,sc.updater,sc.update_time,sc.remark
        from salary_config sc
        join user u on u.user_id=sc.user_id
        <where>
            <if test="login_name != null and login_name != ''">u.login_name like concat('%', #{login_name}, '%')</if>
            <if test="create_time != null and create_time != ''">and DATE_FORMAT(sc.create_time,'%Y-%m') = #{create_time}</if>
        </where>
        order by sc.create_time desc
    </select>

</mapper>